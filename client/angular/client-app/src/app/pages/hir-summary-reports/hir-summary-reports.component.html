<vex-secondary-toolbar [current]="'Danh sách báo cáo'">
    <globits-breadcrumbs [crumbs]="breadcrumbs" class="flex-auto"></globits-breadcrumbs>

    <button class="ml-2" color="primary" mat-icon-button type="button">
        <mat-icon svgIcon="mat:more_vert"></mat-icon>
    </button>
</vex-secondary-toolbar>
<vex-page-layout>
    <vex-page-layout-content [class.px-gutter]="'fullwidth'" class="-mt-6">
        <div class="card overflow-auto -mt-16">
            <div class="bg-app-bar px-6 h-16 border-b sticky left-0 flex items-center">
                <form [formGroup]="searchForm" (ngSubmit)="submitSearch()"
                    class="bg-foreground rounded-full border px-4 max-w-[300px] flex-auto flex items-center border border-gray-300">
                    <mat-icon class="icon-sm text-secondary" svgIcon="mat:search"></mat-icon>
                    <input formControlName="keyword" id="keyword" name="keyword"
                        class="px-4 py-2 border-0 outline-none w-full bg-transparent" placeholder="Search..."
                        type="text">
                </form>
                <span class="flex-1"></span>
                <button [matMenuTriggerFor]="columnFilterMenu" class="ml-4 flex-none" mat-icon-button
                    matTooltip="Filter Columns" type="button">
                    <mat-icon svgIcon="mat:filter_list"></mat-icon>
                </button>
            </div>
            <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>
            <ngx-datatable class="material" [rows]="rows" [columnMode]="ColumnMode.force" [headerHeight]="50"
                [footerHeight]="50" rowHeight="auto" [externalPaging]="true" [count]="totalElements"
                [offset]="searchObject.pageIndex - 1" [limit]="searchObject.pageSize" (page)="setPage($event)">
                <ng-container *ngFor="let column of visibleColumns">
                    <ng-container [ngSwitch]="column.prop">
                        <ngx-datatable-column *ngSwitchDefault [name]="column.name" [prop]="column.prop">
                            <ng-template let-row=" row" let-value="value" ngx-datatable-cell-template>
                               {{ value }}
                            </ng-template>
                        </ngx-datatable-column>
                    </ng-container>
                </ng-container>

                <ngx-datatable-column name="Hành động" [sortable]="false" prop="actions">
                    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                        <button routerLink="/hri-summary-reports/create/{{ row?.id }}" mat-icon-button type="button">
                            <mat-icon svgIcon="mat:edit"></mat-icon>
                        </button>
                        <button (click)="handleDelete(row.id)" mat-icon-button type="button">
                            <mat-icon svgIcon="mat:delete"></mat-icon>
                        </button>

                    </ng-template>
                </ngx-datatable-column>

                <ngx-datatable-footer>
                    <ng-template ngx-datatable-footer-template>
                        <globits-datatable-pager (limitChange)="onLimitChange($event)" [page]="searchObject.pageIndex"
                            [size]="searchObject.pageSize" [count]="totalElements" [hidden]="false"
                            (change)="table.onFooterPage($event)">
                        </globits-datatable-pager>
                    </ng-template>
                </ngx-datatable-footer>

            </ngx-datatable>
        </div>

    </vex-page-layout-content>

</vex-page-layout>
<mat-menu #columnFilterMenu="matMenu" xPosition="before" yPosition="below">
    <ng-container *ngFor="let column of columns">
        <button (click)="toggleColumnVisibility(column, $event)" *ngIf="column.prop != 'actions'"
            class="checkbox-item mat-menu-item">
            <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="column.visible" color="primary">
                {{ column.name }}
            </mat-checkbox>
        </button>
    </ng-container>
</mat-menu>